## Incident-Response

### Incident Response Case - DDoS 공격 대응


### 최신 동향

- SK텔레콤부터 최근 롯데카드까지 해킹을 당하면서 금융감독원의 지시로 금융보안원이 블라인드 모의해킹을 시작한다는 뉴스를 봤습니다.

<img width="618" height="1190" alt="image" src="https://github.com/user-attachments/assets/b09a1e21-5f64-4258-8269-854de0e02528" />

-출처 : https://www.khan.co.kr/article/202509031650001


### 목적

- 전 금융권 대상으로 2개월간의 블라인드 모의해킹으로 DDoS 공격까지 진행할 것으로 예상이 되는데 이를 탐지 및 분석, 대응까지 하는 걸 목적으로 진행해보겠습니다.


### 탐지 및 분석

- Arcsight간 DDoS 이벤트 다수 발생 확인
- DDoS 모니터링간 트래픽 유입량 bps가 평균치를 넘기려고 할 때 ex) 1Gbps
- Splunk 로그 조회
   index=sec_ddos | stats count by src_ip


### 대응 조치 
- 최상위 IP 50개 대상으로 DDoS 1일 차단 대응
- DDoS 모니터링간 평균적인 트래픽 유입량을 초과할 때, PM, PL, 담당자에게 보고
- 금융보안원 우회 요청
- DDoS 정책 대응 ex) 탐지 -> 방어
- 대응 후 블랙리스트 공유 및 대응 보고서 작성 후 담당자에게 전달 (2시간 이내)


### 방향성
- 금융권 특성상 "탐지 - 분석 - 대응 - 보고" 전 단계의 표준화된 워크플로우 구축이 필수적
- Application-layer DDoS에 대응 가능한 탐지 로직 강화 ex) 비정상 요청 패턴 기반 룰 
- API  모니터링 자동화 및 스트레스 테스트 로깅 체계 마련
- 최신 DDoS 트렌드(ex 하이퍼 볼류메트릭 공격, botnet 기반 multi-vector 공격 등)에 대한 시뮬레이션 대응 연습과 정기적인 모의훈련 체계 구축



### 애플리케이션 계층 DDoS 공격 탐지 로직 강화

애플리케이션 계층 DDoS 공격에 효과적으로 대응하려면 **정상적인 사용자 요청과 비정상적인 공격 요청을 구분**하는 것이 가장 중요합니다. 이를 위해 단순한 트래픽 양을 넘어, 요청의 **패턴, 특징, 행위**를 분석하는 것이 핵심입니다.

---

### 1. 비정상 요청 패턴 기반 탐지

이 방법은 공격 트래픽이 보이는 고유한 패턴을 식별해내는 데 초점을 맞춥니다.

* **HTTP 헤더 분석**: 정상적인 웹 브라우저는 'User-Agent', 'Referer', 'Accept-Encoding' 등 다양한 HTTP 헤더를 포함합니다. 하지만 공격 툴은 특정 헤더를 누락하거나, 동일한 값을 반복적으로 사용하거나, 비정상적인 길이의 헤더를 사용합니다. 이러한 패턴을 탐지하여 차단할 수 있습니다.
* **요청 URL 패턴 분석**: 정상 사용자는 여러 페이지를 탐색하며 다양한 URL에 요청을 보냅니다. 반면 공격자는 로그인 페이지, 검색 API 등 **특정 URL에만 집중적으로 요청**을 보냅니다. 짧은 시간 내에 특정 URL에 대한 요청이 급증하면 이를 공격으로 의심할 수 있습니다.
* **요청 속도 및 빈도 분석**: 특정 IP 주소나 세션에서 발생하는 요청의 속도가 비정상적으로 빠르거나, 매우 일정한 간격으로 반복되면 봇에 의한 공격일 가능성이 높습니다. 예를 들어, 1초에 100건 이상의 동일한 요청을 보내는 경우를 탐지 룰로 설정할 수 있습니다.

---

### 2. 행위 기반 탐지 로직 강화

단순한 패턴을 넘어, 사용자의 전체적인 **행동 흐름**을 분석하여 정상 사용자와 공격자를 구분하는 방법입니다.

* **세션 기반 행위 분석**: 정상 사용자는 웹사이트를 둘러보며 여러 페이지에 접속하고, 일정 시간 간격으로 요청을 보냅니다. 그러나 공격자는 세션 시작과 동시에 로그인 API에만 수천 건의 요청을 보내는 등 비정상적인 행동을 보입니다.
* **비정상적인 매개변수 값 탐지**: 로그인이나 결제와 같은 API 요청 시, 비정상적인 길이의 사용자 이름, 존재하지 않는 상품 코드, 비정상적인 결제 정보 등을 반복적으로 사용하는 경우를 탐지할 수 있습니다. 이는 자동화된 공격 봇이 시스템의 취약점을 탐색하는 행위일 수 있습니다.
* **자바스크립트 챌린지 및 캡챠**: 웹 브라우저에서만 정상적으로 실행되는 자바스크립트 챌린지를 적용하여 봇을 걸러낼 수 있습니다. 봇은 자바스크립트를 해석하고 실행하는 능력이 제한적이기 때문입니다. 

---

### 3. 강화된 탐지 로직의 적용 예시

웹사이트의 로그인 페이지에 다음과 같은 탐지 로직을 적용할 수 있습니다.

* **룰 1**: 1분당 로그인 요청이 10건을 초과하는 IP를 차단합니다 (**빈도 기반**).
* **룰 2**: 'User-Agent' 헤더가 없거나 'curl' 등 비정상적인 값인 요청을 차단합니다 (**패턴 기반**).
* **룰 3**: 첫 페이지 로드 후 5초 이내에 로그인 API에 5회 이상 요청을 보내는 세션을 차단합니다 (**행위 기반**).


### 1️⃣ 하이퍼 볼류메트릭 공격 (Hyper-Volumetric DDoS Attack)

**정의:** 초대형 규모의 트래픽을 발생시켜 네트워크 대역폭을 완전히 소모시키는 공격입니다. 공격 트래픽의 규모가 일반적인 DDoS 공격의 수십 배에서 수백 배에 달하며, 주로 **Gbps**를 넘어 **Tbps** 단위로 측정됩니다.

**특징:**

* **압도적 규모:** 엄청난 양의 데이터를 한 번에 쏟아부어 네트워크 자체를 마비시키는 것을 목표로 합니다.
* **분산된 출처:** 전 세계에 퍼져있는 수백만 대의 봇넷이 동시에 공격을 수행하기 때문에 특정 지역에서 오는 트래픽을 차단하는 것이 어렵습니다.
* **순간적 폭증:** 공격이 시작되면 트래픽이 순식간에 수십 Tbps까지 치솟아 방어 시스템이 대응할 시간을 주지 않습니다.
* **주요 공격 기법:** UDP Flood, SYN Flood, DNS Amplification 등 대역폭을 빠르게 채우는 기법들이 주로 사용됩니다. 

**방어 전략:**

* **대규모 네트워크 인프라:** 단일 기업의 방어 장비로는 막기 어려우므로, CDN(콘텐츠 전송 네트워크)이나 클라우드 기반의 DDoS 스크러빙 센터를 활용하여 공격 트래픽을 분산하고 필터링해야 합니다.
* **네트워크 레벨 필터링:** 네트워크 에지(edge) 단에서 비정상적인 트래픽을 실시간으로 탐지하고 차단하는 기술이 필수적입니다.

***

### 2️⃣ 봇넷 기반 멀티 벡터 공격 (Botnet-based Multi-Vector DDoS Attack)

**정의:** 네트워크, 프로토콜, 애플리케이션 등 다양한 계층의 공격 기법을 섞어 사용하는 복합적인 공격입니다. 방어 시스템의 약점을 다각도로 파고들어 효율적인 대응을 어렵게 만듭니다.

**특징:**

* **다중 공격 벡터:** 볼류메트릭(대용량), 프로토콜(세션 고갈), 애플리케이션(CPU 부하) 공격이 순차적으로 또는 동시에 진행됩니다.
* **지능적 회피:** 특정 계층의 방어 솔루션이 대응하는 동안 다른 계층의 공격을 추가하여 방어 체계를 우회합니다.
* **봇넷 활용:** 수많은 좀비 PC나 IoT 기기를 활용하여 공격을 분산시키기 때문에 공격 트래픽의 정상성을 구분하기가 까다롭습니다.
* **공격 예시 시나리오:**
    1.  **UDP Flood**로 네트워크 장비의 대역폭을 압박합니다.
    2.  이후 **SYN Flood**로 방화벽/IPS의 세션 테이블을 고갈시킵니다.
    3.  마지막으로 **HTTP Flood**로 웹 서버의 CPU를 소모시켜 정상적인 서비스 접속을 마비시킵니다.

**방어 전략:**

* **통합적 다계층 방어:** 특정 한 계층의 방어만으로는 부족합니다. 네트워크, 전송, 애플리케이션 계층을 모두 아우르는 통합 보안 솔루션이 필요합니다.
* **행위 기반 탐지:** 트래픽 패턴만으로는 공격을 구분하기 어려우므로, 비정상적인 사용자 행위나 트래픽 흐름을 분석하여 공격을 탐지하는 기술이 중요합니다.
* **자동화된 대응:** 다양한 공격 기법에 대해 즉각적으로 대응할 수 있도록, 위협 정보를 실시간으로 업데이트하고 자동화된 방어 룰을 적용해야 합니다.
